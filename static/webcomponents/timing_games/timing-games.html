<!-- webview for timing games
significant code taken from bimatrix
-->

<link
    rel="import"
    href="/static/bower_components/polymer/polymer.html" />
<link
    rel="import"
    href="/static/otree-redwood/webcomponents/redwood-channel/redwood-channel.html">
<link
    rel="import"
    href="/static/otree-redwood/webcomponents/redwood-decision/redwood-decision.html">
<link
    rel="import"
    href="/static/otree-redwood/webcomponents/redwood-period/redwood-period.html">
<link
    rel="import"
    href="/static/webcomponents/timing_games/polymer-bubbles/polymer-bubbles.html">
<link
    rel="import"
    href="/static/webcomponents/timing_games/polymer-bubbles/payoff-graph.html">
<link
    rel="import"
    href="/static/webcomponents/timing_games/polymer-bubbles/strategy-graph.html">
<link
    rel="import"
    href="/static/webcomponents/timing_games/polymer-bubbles/bubbles-graph.html">
<link
    rel="import"
    href="/static/webcomponents/timing_games/polymer-bubbles/colors.js">
<link
    rel="import"
    href="/static/webcomponents/timing_games/polymer-bubbles/range.css">


<dom-module id="timing-games">

<template>
    <div>
        <polymer-bubbles
            max-payoff='400'
            other-decisions='[[ otherDecisions ]]'
            my-decision='{{ myDecision }}'
            payoff-function='[[ _payoffFunction ]]'
            duration='120'
            others-bubbles='payoff'
            >
        </polymer-bubbles>
    </div>

    <otree-constants id="constants"></otree-constants>

    <redwood-period
        running="{{ _isPeriodRunning }}"
        on-period-start="_onPeriodStart"
        on-period-end="_onPeriodEnd">
    </redwood-period>

    <redwood-decision
        initial-decision="[[ initialDecision ]]"
        my-decision="{{ myPlannedDecision }}"
        my-current-decision="{{ myDecision }}"
        max-per-second="10"
        on-group-decisions-changed="_onGroupDecisionsChanged">
    </redwood-decision>
</template>

<script>
  Polymer({
      is: 'timing-games',
      properties: {
          initialDecision: {
              type: Number,
          },
          myDecision: {
              type: Number,
          },
          otherDecisions: {
              type: Array,
              computed: '_onGroupDecisionsChanged()',
          },
          periodLength: Number,

          // set by redwood-period
          _isPeriodRunning: {
              type: Boolean
          },
          _subperiodProgress: {
              type: Number,
              value: 0,
          },
          _payoffFunction: {
              type: Object,
              value: function() {
                  return this.getPayoff;
              },
          },
      },
      ready() {
          this.$$('polymer-bubbles').roundStart();
          this.myDecision = this.initialDecision;
      },
      getPayoff(myDecision, otherDecisions) {
          return 25;
      },
      _onGroupDecisionsChanged() {
          var dec = [];
          for (var id in this.$.groupDecisions) {
              if(id.localeCompare(this.$.constants.idInGroup) != 0) {
                  dec.push(this.$.groupDecisions[id]);
              }
          }
          return dec;
      },
    })
</script>

</dom-module>
